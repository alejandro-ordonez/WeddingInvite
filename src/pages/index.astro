---
import Layout from '../layouts/Layout.astro';
import VineDecoration from '../components/VineDecoration.astro';
import SunflowerDecoration from '../components/SunflowerDecoration.astro';
import TurquoiseAccents from '../components/TurquoiseAccents.astro';
import InvitationCard from '../components/InvitationCard.astro';
import PhotoCarousel from '../components/PhotoCarousel.astro';
import FallingLeaves from '../components/FallingLeaves.astro';
import headerImage from '../assets/header.jpg';
import cornerBorder from '../assets/corner-boder.png';

// Photo imports
import photo1 from '../assets/photos/IMG_8556.jpg';
import photo9 from '../assets/photos/IMG_8565.jpg';
import photo2 from '../assets/photos/_MG_0396.jpg';
import photo3 from '../assets/photos/_MG_0410.jpg';
import photo4 from '../assets/photos/IMG_7830.jpg';
import photo5 from '../assets/photos/IMG_7916.jpg';
import photo6 from '../assets/photos/IMG_8001.jpg';
import photo7 from '../assets/photos/IMG_8006-Enhanced-NR.jpg';
import photo8 from '../assets/photos/IMG_8089-Enhanced-NR.jpg';

// You can customize these values
const weddingDetails = {
	// Header image (inside the white frame)
	headerImage: headerImage.src,
	headerTitle: "Save The Date",
	headerSubtitle: "Comparte con nosotros esta fecha especial",
	headerAlt: "Wedding celebration",

	// Wedding details
	bride : "Alejandro",
	groom : "Abigail",
	date : "Domingo, 25 de Enero, 2026",
	time : "3:30 PM",
	venue : "Casa Aragon",
	address : "KM. 16, Autopista Medell√≠n, El Rosal, Cundinamarca",
	rsvpDate : "15 de Noviembre",
};

// Add your photos here (leave empty for placeholders)
const photos = [
	{ src: photo1.src, alt: "First date" },
	{ src: photo2.src, alt: "Proposal" },
	{ src: photo3.src, alt: "Engagement" },
	{ src: photo4.src, alt: "Adventures together" },
	{ src: photo5.src, alt: "With family" },
	{ src: photo6.src, alt: "Our love story" },
	{ src: photo7.src, alt: "Beautiful moments" },
	{ src: photo8.src, alt: "Together forever" },
	{ src: photo9.src, alt: "Together forever" }
];
---

<Layout>
	<!-- Falling Leaves Animation -->
	<FallingLeaves />

	<!-- Corner Borders -->
	<div class="corner-border corner-top-left" style={`background-image: url(${cornerBorder.src});`}></div>
	<div class="corner-border corner-bottom-right" style={`background-image: url(${cornerBorder.src});`}></div>

	<div class="invitation-container">
		<!-- Decorative Elements -->
		<VineDecoration position="top-left" />
		<SunflowerDecoration position="top-right" />
		<SunflowerDecoration position="bottom-left" />
		<VineDecoration position="bottom-right" />
		<TurquoiseAccents />

		<!-- Main Content with Header Image and Carousel -->
		<InvitationCard {...weddingDetails}>
			<PhotoCarousel photos={photos} title="Nosotros:" />
		</InvitationCard>
	</div>
</Layout>

<style>
	.corner-border {
		position: fixed;
		z-index: 100;
		width: 350px;
		height: 350px;
		pointer-events: none;
		background-repeat: no-repeat;
		background-size: contain;
		opacity: 0.8;
	}

	.corner-top-left {
		top: 0;
		left: 0;
		background-position: top left;
		transform: scaleX(-1);
	}

	.corner-bottom-right {
		bottom: 0;
		right: 0;
		background-position: bottom right;
		transform: scaleY(-1);
	}

	.invitation-container {
		position: relative;
		min-height: 100vh;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		padding: 5rem 2rem;
		overflow: hidden;
		z-index: 1;
	}

	@media (max-width: 768px) {
		.corner-border {
			width: 350px;
			height: 350px;
		}

		.invitation-container {
			padding: 2rem 1rem;
		}
	}

	@media (max-width: 480px) {
		.corner-border {
			width: 180px;
			height: 180px;
		}
	}
</style>

<script>
	// Read base64 encoded guest parameter from URL
	const urlParams = new URLSearchParams(window.location.search);
	const encodedGuest = urlParams.get('guest');

	// Decode and parse the guest data
	let guestId = null;
	let guestName = null;

	try {
		if (!encodedGuest) {
			throw new Error('Missing guest parameter');
		}

		// Decode from base64
		// Decode Base64 to bytes
		const decodedBytes = Uint8Array.from(atob(encodedGuest), c => c.charCodeAt(0));

		// Convert bytes to UTF-8 string
		const utf8String = new TextDecoder("utf-8").decode(decodedBytes);

		// Parse JSON
		const guestData = JSON.parse(utf8String);


		guestId = guestData.id;
		guestName = guestData.name;

		// Validate that both id and name exist
		if (!guestId || !guestName) {
			throw new Error('Invalid guest data');
		}

		// Display the guest name
		const guestNameElement = document.getElementById('guestNameDisplay');
		if (guestNameElement) {
			guestNameElement.textContent = guestName;
			guestNameElement.style.display = 'block';
		}

		// Store guest ID for potential future use (e.g., RSVP tracking)
		sessionStorage.setItem('guestId', guestId);
	} catch (error) {
		// If decoding fails or data is invalid, redirect to 404
		window.location.href = '/404';
	}
</script>
